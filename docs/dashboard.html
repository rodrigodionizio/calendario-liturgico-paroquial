<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sacristia Digital | Painel de GestÃ£o</title>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Design System: Principal + Dashboard -->
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/dashboard.css" />

    <!-- Favicon PadrÃ£o -->
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <!-- Favicon em Alta ResoluÃ§Ã£o -->
    <link rel="icon" type="image/png" href="assets/img/favicon.ico" />

    <style>
      /* Bloqueio de visibilidade prÃ©-auth (SeguranÃ§a UX) */
      body {
        opacity: 0;
        transition: opacity 0.4s ease;
      }
      body.auth-ok {
        opacity: 1;
      }

      /* Controle de Abas */
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="admin-body">
    <!-- SIDEBAR: NAVEGAÃ‡ÃƒO MESTRE -->
    <nav class="admin-sidebar">
      <div class="admin-logo">
        <img
          src="assets/img/logo-horizontal-negativa.png"
          alt="Sacristia Digital"
          style="width: 180px"
        />
      </div>

      <div class="menu-item active" data-tab="visao-geral">ğŸ“Š VisÃ£o Geral</div>
      <div class="menu-item" data-tab="agenda-total">ğŸ“… Agenda Total</div>
      <div class="menu-item" data-tab="equipes">ğŸ‘¥ Gerenciar Equipes</div>

      <!-- Este menu sÃ³ aparecerÃ¡ via JS para Admins NÃ­vel 1 e 2 -->
      <div
        class="menu-item"
        data-tab="usuarios"
        id="menu-usuarios"
        style="display: none"
      >
        ğŸ” GestÃ£o de Acessos
      </div>

      <a
        href="index.html"
        class="menu-item"
        style="
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          margin-top: 20px;
          opacity: 0.6;
        "
      >
        ğŸŒ Ver Site PÃºblico
      </a>

      <div
        class="menu-item"
        onclick="window.api.logout()"
        style="margin-top: auto; color: #ff9999"
      >
        ğŸšª Sair do Sistema
      </div>
    </nav>

    <!-- ÃREA DE CONTEÃšDO DINÃ‚MICO -->
    <main class="admin-main">
      <!-- HEADER COM PERFIL -->
      <div class="page-header">
        <h1 class="page-title" id="tab-title-display">Painel de Controle</h1>
        <div class="user-profile">
          OlÃ¡, <span id="user-name">Carregando...</span>
          <div class="avatar"></div>
        </div>
      </div>

      <!-- ABA 1: VISÃƒO GERAL (MÃ©tricas e GrÃ¡ficos) -->
      <section id="tab-visao-geral" class="tab-content active">
        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-value" id="kpi-semana">0</div>
            <div class="kpi-label">Eventos na Semana</div>
          </div>
          <div class="kpi-card" style="border-left-color: var(--cor-cereja)">
            <div class="kpi-value" id="kpi-pendentes">0</div>
            <div class="kpi-label">Aguardando AprovaÃ§Ã£o</div>
          </div>
          <div class="kpi-card" style="border-left-color: #2e7d32">
            <div class="kpi-value" id="kpi-mural">0</div>
            <div class="kpi-label">Avisos no Mural</div>
          </div>
          <div class="kpi-card" style="border-left-color: #2196f3">
            <div class="kpi-value" id="kpi-equipes">0</div>
            <div class="kpi-label">Equipes Ativas</div>
          </div>
        </div>

        <div class="dashboard-split">
          <div class="panel">
            <div class="panel-title">Volume de Atividades (Carga)</div>
            <div class="chart-container" id="chart-week"></div>
          </div>
          <div class="panel">
            <div class="panel-title">Atividades Recentes</div>
            <div id="admin-event-list">
              <!-- Injetado por DashboardController.renderizarListaRecentes -->
            </div>
          </div>
        </div>
      </section>

      <!-- ABA 2: AGENDA TOTAL (O CalendÃ¡rio de GestÃ£o) -->
      <section id="tab-agenda-total" class="tab-content">
        <div class="panel">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h2
              id="admin-calendar-month"
              class="month-name"
              style="color: var(--cor-vinho); margin: 0"
            >
              ...
            </h2>
            <div class="nav-buttons">
              <button
                class="btn-nav"
                onclick="window.DashboardController.navegarAgenda(-1)"
              >
                &lt;
              </button>
              <button
                class="btn-nav"
                onclick="window.DashboardController.navegarAgenda(0)"
              >
                Hoje
              </button>
              <button
                class="btn-nav"
                onclick="window.DashboardController.navegarAgenda(1)"
              >
                &gt;
              </button>
            </div>
          </div>
          <div class="calendar-wrapper" id="admin-calendar-grid">
            <!-- Motor calendar-engine.js atuando aqui -->
          </div>
        </div>
      </section>

      <!-- ABA 3: EQUIPES (CRUD de Pastorais) -->
      <section id="tab-equipes" class="tab-content">
        <!-- Injetado por DashboardController.renderizarAbaEquipes -->
      </section>

      <!-- ABA 4: USUÃRIOS (Controle de Acesso) -->
      <section id="tab-usuarios" class="tab-content">
        <!-- Injetado por DashboardController.renderizarAbaUsuarios -->
      </section>
    </main>

    <!-- MODAL DE EDIÃ‡ÃƒO / GESTÃƒO -->
    <div
      class="modal-overlay"
      id="modalOverlay"
      onclick="if(event.target == this) this.classList.remove('active')"
    >
      <div id="modalContent"></div>
    </div>

    <!-- SCRIPTS MESTRES (Ordem CrÃ­tica) -->
    <script src="assets/js/api.js"></script>
    <script src="assets/js/calendar-engine.js"></script>
    <script src="assets/js/dashboard.js"></script>
  </body>
</html>
