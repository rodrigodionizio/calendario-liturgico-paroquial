<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Administrativo | Sacristia Digital</title>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Estilos: Principal + Dashboard EspecÃ­fico -->
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/dashboard.css" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      href="assets/img/logo-paroquia-colorida.png"
    />

    <style>
      /* ProteÃ§Ã£o visual inicial enquanto o JS valida a sessÃ£o */
      body {
        opacity: 0;
        transition: opacity 0.3s;
      }
      body.auth-ok {
        opacity: 1;
      }

      /* Estilo para as abas de conteÃºdo */
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
    </style>
  </head>
  <body class="admin-body">
    <!-- SIDEBAR DE NAVEGAÃ‡ÃƒO -->
    <nav class="admin-sidebar">
      <div class="admin-logo">
        <img
          src="assets/img/logo-horizontal-negativa.png"
          alt="Logo"
          style="width: 180px"
        />
      </div>

      <div class="menu-item active" data-tab="visao-geral">ðŸ“Š VisÃ£o Geral</div>
      <div class="menu-item" data-tab="aprovacoes">
        âœ… AprovaÃ§Ãµes <span class="menu-badge" id="badge-pendentes">0</span>
      </div>
      <div class="menu-item" data-tab="agenda-total">ðŸ“… Agenda Total</div>
      <div class="menu-item" data-tab="equipes">ðŸ‘¥ Equipes</div>
      <div class="menu-item" data-tab="usuarios" id="menu-usuarios" style="display:none;">ðŸ‘¤ GestÃ£o de Acesso </div>

      <div
        class="menu-item"
        onclick="window.api.logout()"
        style="margin-top: auto; border-top: 1px solid rgba(255, 255, 255, 0.1)"
      >
        ðŸšª Sair do Sistema
      </div>
    </nav>

    <!-- ÃREA DE CONTEÃšDO PRINCIPAL -->
    <main class="admin-main">
      <!-- HEADER DO PAINEL -->
      <header class="page-header">
        <div class="page-title" id="tab-title">Painel de Controle</div>
        <div class="user-profile">
          OlÃ¡, <span id="admin-nome">Coordenador</span>
          <div class="avatar"></div>
        </div>
      </header>

      <!-- CONTEÃšDO DINÃ‚MICO POR ABAS -->

      <!-- ABA 1: VISÃƒO GERAL -->
      <section id="tab-visao-geral" class="tab-content active">
        <!-- KPIs (Injetados via Dashboard.js) -->
        <div class="kpi-grid" id="kpi-container">
          <div style="padding: 20px; color: #888">Carregando mÃ©tricas...</div>
        </div>

        <div class="dashboard-split">
          <!-- GrÃ¡fico de Atividades -->
          <div class="panel">
            <div class="panel-title">Volume de Atividades (PrÃ³x. 7 Dias)</div>
            <div class="chart-container" id="admin-chart">
              <!-- Barras dinÃ¢micas injetadas pelo JS -->
            </div>
          </div>

          <!-- Lista de PrÃ³ximas PendÃªncias -->
          <div class="panel">
            <div class="panel-title">Aguardando AprovaÃ§Ã£o</div>
            <div id="lista-pendentes-resumo">
              <div style="color: #999; font-style: italic; padding: 10px">
                Buscando pendÃªncias...
              </div>
            </div>
            <div style="margin-top: 20px; text-align: center">
              <button
                class="btn-ver-todas"
                onclick="document.querySelector('[data-tab=aprovacoes]').click()"
              >
                Gerenciar Todas
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- ABA 2: APROVAÃ‡Ã•ES -->
      <section id="tab-aprovacoes" class="tab-content">
        <div class="panel">
          <div class="panel-title">Gerenciar SolicitaÃ§Ãµes de Agenda</div>
          <p style="color: #666; margin-bottom: 20px">
            Aprove ou rejeite eventos criados pelas pastorais.
          </p>
          <div id="lista-aprovacao-completa">
            <!-- Tabela de aprovaÃ§Ã£o serÃ¡ injetada aqui -->
          </div>
        </div>
      </section>

      <!-- ABA 3: EQUIPES -->
      <section id="tab-equipes" class="tab-content"></section>

      <!-- ABA 4: AGENDA TOTAL -->
      <section id="tab-agenda-total" class="tab-content">
        <div class="panel">
          <div class="panel-title">Gerenciar Agenda Paroquial</div>
          <!-- HEADER DE NAVEGAÃ‡ÃƒO DA AGENDA (DINÃ‚MICO) -->
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
              border-bottom: 1px solid #f0f0f0;
              padding-bottom: 15px;
            "
          >
            <!-- O ID "admin-calendar-month" serÃ¡ preenchido pelo DashboardController.js -->
            <h2
              id="admin-calendar-month"
              class="month-name"
              style="margin: 0; color: var(--cor-vinho); font-size: 1.8rem"
            >
              Carregando...
            </h2>

            <!-- BOTÃ•ES DE CONTROLE DE FLUXO -->
            <div class="nav-buttons">
              <button
                class="btn-nav"
                onclick="window.DashboardController.navegarAgenda(-1)"
                title="MÃªs Anterior"
              >
                &lt;
              </button>
              <button
                class="btn-nav"
                onclick="window.DashboardController.navegarAgenda(0)"
              >
                Hoje
              </button>
              <button
                class="btn-nav"
                onclick="window.DashboardController.navegarAgenda(1)"
                title="PrÃ³ximo MÃªs"
              >
                &gt;
              </button>
            </div>
          </div>

          <!-- O MOTOR VAI CONSTRUIR O CALENDÃRIO AQUI DENTRO -->
          <div id="admin-calendar-grid" class="calendar-wrapper"></div>
        </div>
      </section>
      <!-- Gerenciamento de Acesso -->
      <section id="tab-usuarios" class="tab-content">
          <div class="panel">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                  <div class="panel-title">UsuÃ¡rios Autorizados</div>
                  <button onclick="window.DashboardController.abrirModalUsuario()" class="btn-ver-todas">ï¼‹ Novo UsuÃ¡rio</button>
              </div>
              <div id="lista-usuarios-container">
                  <!-- Tabela de usuÃ¡rios injetada via JS -->
              </div>
          </div>
      </section>
    </main>
    <!-- ==========================================================================
         COMPONENTES DE INTERFACE (MODAIS)
         Devem ficar ao final para garantir prioridade visual (Z-Index)
    ========================================================================== -->
    <div
      class="modal-overlay"
      id="modalOverlay"
      onclick="if(event.target == this) this.classList.remove('active')"
    >
      <div id="modalContent">
        <!-- O DashboardController.js vai injetar o formulÃ¡rio aqui -->
      </div>
    </div>

    <!-- MÃSCARA PARA MENU MOBILE (Se aplicÃ¡vel) -->
    <div id="sidebar-overlay" onclick="window.toggleSidebarMobile()"></div>

    <!-- SCRIPTS DE INICIALIZAÃ‡ÃƒO -->
    <script src="assets/js/api.js"></script>
    <script src="assets/js/calendar-engine.js"></script>
    <script src="assets/js/dashboard.js"></script>
  </body>
</html>
